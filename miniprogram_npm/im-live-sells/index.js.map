{"version":3,"sources":["tls.min.js"],"names":[],"mappings":";;;;;;;AAAA","file":"index.js","sourcesContent":["!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports[\"im-live-sells\"]=e():t[\"im-live-sells\"]=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=0)}([function(t,e,n){Object.defineProperty(e,\"__esModule\",{value:!0});var i=n(1);e.default=i.default},function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{a(i.next(t))}catch(t){r(t)}}function u(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(r){return function(u){return function(r){if(n)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,u])}}};Object.defineProperty(e,\"__esModule\",{value:!0});var r=n(2),s=n(3),u=n(4),a=function(){function t(t){this.tim=null,this.userName=\"\",this.userSig=\"\",this.SDKAppID=0,this.roomID=\"\",this.groupCustomFieldFilter=[],this.userInfo={},this.groupInfo={},this.isSdkReady=!1,this.eventBus=new u.EventBus,this.initComponentMemberValue(t),this.initIMSDK(t)}return t.prototype.initIMSDK=function(t){var e=this;return new Promise((function(n,r){return i(e,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return this.TIM=t.TIM,this.groupCustomFieldFilter=t.groupCustomFieldFilter,this.tim=this.TIM.create({SDKAppID:t.SDKAppID,scene:\"tls\"}),this.tim.setLogLevel(0),this.tim.on(this.TIM.EVENT.SDK_READY,this.sdkReady.bind(this)),this.tim.on(this.TIM.EVENT.MESSAGE_RECEIVED,this.messageReceived.bind(this)),this.tim.on(this.TIM.EVENT.PROFILE_UPDATED,this.profileUpdate.bind(this)),this.tim.on(this.TIM.EVENT.ERROR,this.error.bind(this)),this.tim.on(this.TIM.EVENT.SDK_NOT_READY,this.sdkNotReady.bind(this)),this.tim.on(this.TIM.EVENT.KICKED_OUT,this.kicked.bind(this)),this.tim.on(this.TIM.EVENT.NET_STATE_CHANGE,this.networkChange.bind(this)),[4,this.tim.login({userID:this.userName,userSig:this.userSig})];case 1:return(e=i.sent())?(e.data.repeatLogin&&this.sdkReady(),n(e)):r({}),[2]}}))}))}))},t.prototype.destroy=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return this.tim.destroy(),this.eventBus.events={},[2]}))}))},t.prototype.sendMessage=function(t){var e=this;return new Promise((function(n,i){var o=e.tim.createTextMessage({to:e.roomID,conversationType:e.TIM.TYPES.CONV_GROUP,payload:{text:t}});e.tim.sendMessage(o).then((function(o){0===o.code?n({nick:e.userInfo.nick,avatar:e.userInfo.avatar,message:t}):i(o)})).catch((function(t){i(t)}))}))},t.prototype.like=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.sendCustomMsgAndEmitEvent(t,e,this.TIM.TYPES.MSG_PRIORITY_LOWEST)]}))}))},t.prototype.buy=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.sendCustomMsgAndEmitEvent(t,JSON.stringify(e))]}))}))},t.prototype.sendCustomMsgAndEmitEvent=function(t,e,n){return i(this,void 0,void 0,(function(){var i,r;return o(this,(function(o){switch(o.label){case 0:return i=this.tim.createCustomMessage({to:this.roomID,conversationType:this.TIM.TYPES.CONV_GROUP,priority:n||this.TIM.TYPES.MSG_PRIORITY_HIGH,payload:{data:t,description:\"\",extension:e}}),[4,this.tim.sendMessage(i)];case 1:return o.sent(),r={nick:this.userInfo.nick,avatar:this.userInfo.avatar,value:e,userID:this.userInfo.userID},this.eventBus.emit(t,r),[2,r]}}))}))},t.prototype.useCoupon=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.sendCustomMsgAndEmitEvent(\"USE_COUPON\",t)]}))}))},t.prototype.sendGift=function(t){return this.sendCustomMsgAndEmitEvent(\"SEND_GIFT\",t,this.TIM.TYPES.MSG_PRIORITY_LOWEST)},t.prototype.exitRoom=function(){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(e){return[2,new Promise((function(e,n){return i(t,void 0,void 0,(function(){var t;return o(this,(function(i){switch(i.label){case 0:return this.userInfo.userID===this.groupInfo.ownerID?(e({}),[2]):[4,this.tim.quitGroup(this.roomID)];case 1:return 0===(t=i.sent()).code?e(t.data):n(t),[2]}}))}))}))]}))}))},t.prototype.joinRoom=function(t){return void 0===t&&(t={getOwnerInfo:!0,roomID:\"\"}),i(this,void 0,void 0,(function(){var e,n,i,r;return o(this,(function(o){switch(o.label){case 0:if(t.roomID)this.roomID=t.roomID;else if(this.roomID)throw new Error(\"roomID为必填\");return[4,this.tim.joinGroup({groupID:t.roomID?t.roomID:this.roomID,type:this.TIM.TYPES.GRP_AVCHATROOM})];case 1:return 0!==(e=o.sent()).code||\"JoinedSuccess\"!==e.data.status?[3,5]:t.getOwnerInfo?(n=e.data.group.ownerID,[4,this.getUserInfoByID(n)]):[3,3];case 2:i=o.sent(),e.data.group.ownerInfo=i,o.label=3;case 3:return[4,this.getMyProfile()];case 4:return r=o.sent(),this.groupInfo=e.data.group,[2,{groupInfo:e.data.group,userInfo:r}];case 5:return 0!==e.code||\"AlreadyInGroup\"!==e.data.status?[3,7]:(this.groupInfo=e.data.group,[4,this.getMyProfile()]);case 6:return r=o.sent(),[2,{groupInfo:e.data.group,userInfo:r}];case 7:return[2,null]}}))}))},t.prototype.getRoomInfo=function(){return this.getGroupProfile()},t.prototype.getUserInfo=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.getMyProfile()]}))}))},t.prototype.attention=function(t){return this.sendCustomMsgAndEmitEvent(\"ATTENTION\",t)},t.prototype.cancelAttention=function(t){return this.sendCustomMsgAndEmitEvent(\"CANCELATTENTION\",t)},t.prototype.on=function(t,e){this.eventBus.on(t,e)},t.prototype.initComponentMemberValue=function(t){for(var e in t)this[e]=t[e]},t.prototype.sdkReady=function(){this.eventBus.emit(s.default.SDK_READY),this.getMyProfile(),this.getGroupProfile()},t.prototype.messageReceived=function(t){var e=t.data;for(var n in e){var i=e[n],o=i.payload,r=o.operationType;if(\"TIMGroupTipElem\"===i.type){if(1===r){var u={nick:i.nick,avatar:i.avatar,userID:o.operatorID};this.eventBus.emit(s.default.JOIN_GROUP,u)}if(2===r){u={nick:i.nick,avatar:i.avatar,userID:o.operatorID};this.eventBus.emit(s.default.EXIT_GROUP,u)}if(6===r){if(o.newGroupProfile.groupCustomField&&o.newGroupProfile.groupCustomField.length){var a=o.newGroupProfile.groupCustomField[0].key,f=o.newGroupProfile.groupCustomField[0].value;this.eventBus.emit(a,{nick:i.nick,avatar:i.avatar,userID:i.from,value:f})}o.newGroupProfile.notification&&this.eventBus.emit(s.default.NOTIFACATION,{notification:o.newGroupProfile.notification}),o.newGroupProfile&&o.newGroupProfile.name&&this.eventBus.emit(s.default.INTRODUCTION,{name:o.newGroupProfile.name,introduction:o.newGroupProfile.introduction})}}else if(\"TIMTextElem\"===e[n].type){u={nick:e[n].nick,avtar:e[n].avatar,message:e[n].payload.text,userID:e[n].from};this.eventBus.emit(s.default.MESSAGE,u)}else if(\"TIMCustomElem\"===e[n].type){var c={nick:e[n].nick,avatar:e[n].avatar,description:e[n].payload.description,extension:e[n].payload.extension,userID:e[n].from,data:e[n].payload.data};this.eventBus.emit(e[n].payload.data,c),this.eventBus.emit(s.default.MESSAGE,c)}else if(\"TIMGroupSystemNoticeElem\"===e[n].type)try{var l=JSON.parse(o.userDefinedField),p=l.type,d=l.msg;this.eventBus.emit(p,{msg:d})}catch(t){this.eventBus.emit(s.default.MESSAGE,e[n])}else this.eventBus.emit(s.default.MESSAGE,e[n])}},t.prototype.profileUpdate=function(t){this.eventBus.emit(s.default.PROFILE_UPDATE,t)},t.prototype.error=function(t){this.eventBus.emit(s.default.ERROR,t)},t.prototype.kicked=function(t){this.eventBus.emit(s.default.KICKED,t)},t.prototype.networkChange=function(t){this.eventBus.emit(s.default.NETWORK_CHANGE,t)},t.prototype.sdkNotReady=function(t){this.eventBus.emit(s.default.SDK_NOT_READY,t)},t.prototype.getMyProfile=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this.tim.getMyProfile()];case 1:return 0===(t=e.sent()).code?(this.userInfo=t.data,[2,t.data]):[2,null]}}))}))},t.prototype.getGroupProfile=function(){return i(this,void 0,void 0,(function(){var t,e,n;return o(this,(function(i){switch(i.label){case 0:return this.roomID?[4,this.tim.getGroupProfile({groupID:this.roomID,groupCustomFieldFilter:this.groupCustomFieldFilter})]:[2,null];case 1:return 0!==(t=i.sent()).code?[3,3]:(e=t.data.group.ownerID,[4,this.getUserInfoByID(e)]);case 2:return n=i.sent(),t.data.group.ownerInfo=n,this.groupInfo=t.data.group,[2,t.data.group];case 3:return[2,null]}}))}))},t.prototype.getGroupMemberList=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return this.roomID?[2,this.tim.getGroupMemberList({groupID:this.roomID,count:100,offset:0})]:[2,null]}))}))},t.prototype.getUserInfoByID=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this.tim.getUserProfile({userIDList:[t]})];case 1:return 0===(e=n.sent()).code?[2,e.data[0]]:[2,null]}}))}))},t.prototype.addAttention=function(t){return i(this,void 0,void 0,(function(){var e,n,i;return o(this,(function(o){switch(o.label){case 0:return[4,this.getGroupProfile()];case 1:return e=o.sent(),n=r._getVarsByKey(e.groupCustomField,t),i=n||0,[4,this.tim.updateGroupProfile({groupID:this.roomID,groupCustomField:[{key:t,value:String(Number(i)+1)}]})];case 2:return[2,o.sent()]}}))}))},t.EVENT=s.default,t}();e.default=a},function(t,e,n){Object.defineProperty(e,\"__esModule\",{value:!0});e._getVarsByKey=function(t,e){for(var n,i=0;i<t.length;i++)if(t[i].key===e){n=t[i].value;break}return n}},function(t,e,n){var i;Object.defineProperty(e,\"__esModule\",{value:!0}),function(t){t.SDK_READY=\"SDK_READY\",t.JOIN_GROUP=\"JOIN_GROUP\",t.EXIT_GROUP=\"EXIT_GROUP\",t.NOTIFACATION=\"NOTIFACATION\",t.MESSAGE=\"MESSAGE\",t.PROFILE_UPDATE=\"PROFILE_UPDATE\",t.ERROR=\"ERROR\",t.KICKED=\"KICKED\",t.NETWORK_CHANGE=\"NETWORK_CHANGE\",t.SDK_NOT_READY=\"SDK_NOT_READY\",t.LIKE=\"LIKE\",t.BUY_GOODS=\"BUY_GOODS\",t.USE_COUPON=\"USE_COUPON\",t.SEND_GIFT=\"SEND_GIFT\",t.ATTENTION=\"ATTENTION\",t.CANCELATTENTION=\"CANCELATTENTION\",t.ADD_GOODS=\"ADD_GOODS\",t.ROOM_STATUS_CHANGE=\"ROOM_STATUS_CHANGE\",t.INTRODUCTION=\"INTRODUCTION\",t.BIT_BEGIN=\"BIT_BEGIN\",t.BIT_END=\"BIT_END\",t.BIT_CRON_RESULT=\"BIT_CRON_RESULT\",t.BIT_FINAL_RESULT=\"BIT_FINAL_RESULT\",t.SYSTEM_NORMAL_MESSAGE=\"SYSTEM_NORMAL_MESSAGE\"}(i||(i={})),e.default=i},function(t,e,n){Object.defineProperty(e,\"__esModule\",{value:!0});var i=n(5);e.EventBus=i.default},function(t,e,n){Object.defineProperty(e,\"__esModule\",{value:!0});var i=function(){function t(){this.events={}}return t.prototype.on=function(t,e){return this.events[t]=this.events[t]||new Map,this.events[t].set(e,!1),this},t.prototype.once=function(t,e){return this.events[t]=this.events[t]||new Map,this.events[t].set(e,!0),this},t.prototype.off=function(t,e){var n=this.events[t];return n&&(e?n.delete(e):delete this.events[t]),this},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this.events[t];return i&&i.forEach((function(t,n){n.apply(void 0,e),t&&i.delete(n)})),this},t}();e.default=i}]).default}));"]}